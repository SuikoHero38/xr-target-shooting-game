<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XR Target Acquisition Micro-benchmark</title>
    <style>
      html, body { margin: 0; height: 100%; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
      #overlay{
        position: fixed; left: 12px; top: 12px; z-index: 10;
        background: rgba(255,255,255,0.85); color:#111;
        border: 1px solid rgba(0,0,0,0.08);
        padding: 12px; border-radius: 12px; min-width: 340px;
        backdrop-filter: blur(6px);
      }
      h1{ font-size: 14px; margin:0 0 8px 0; font-weight: 700;}
      #grid{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; align-items:center; }
      label{ font-size:12px; opacity:0.9;}
      select, input[type="range"], button{
        width:100%; margin-top:4px; border-radius:10px;
        border:1px solid rgba(0,0,0,0.12); background:white; color:#111;
        padding:9px;
      }
      button{ cursor:pointer; }
      button:disabled{ opacity:0.5; cursor:not-allowed; }
      #status{ margin-top:10px; font-size:12px; line-height:1.35;}
      #help{ margin-top:8px; font-size:11px; opacity:0.8; }
      #surveyModal{
        position: fixed; inset: 0; display:none; align-items:center; justify-content:center; z-index:20;
        background: rgba(0,0,0,0.35);
      }
      #surveyCard{
        width:min(560px, calc(100vw - 24px));
        background:#fff; border:1px solid rgba(0,0,0,0.12);
        border-radius:14px; padding:16px;
      }
      #surveyCard h2{ font-size:16px; margin:0 0 10px 0; }
      .q{ margin: 10px 0; }
      .q b{ display:block; font-size:12px; margin-bottom:6px; opacity:0.95; }
      .likert{ display:grid; grid-template-columns: repeat(7, 1fr); gap:8px; }
      .likert label{
        display:flex; align-items:center; justify-content:center; gap:6px; padding:8px 6px;
        border:1px solid rgba(0,0,0,0.12); border-radius:10px; cursor:pointer; user-select:none;
        background: rgba(0,0,0,0.02);
      }
      #surveyActions{ display:flex; gap:10px; margin-top:12px; }
    </style>
  </head>
  <body>
    <div id="overlay">
      <h1>XR Target Acquisition Micro-benchmark</h1>

      <div id="grid">
        <div>
          <label>Interaction</label>
          <select id="interactionSelect">
            <option value="MOUSE_RAY">Mouse ray (desktop-friendly)</option>
            <option value="CENTER_GAZE">Center gaze (VR-like)</option>
          </select>
        </div>

        <div>
          <label>Targets: <span id="nVal">20</span></label>
          <input id="nSlider" type="range" min="10" max="60" step="5" value="20" />
        </div>

        <div>
          <label>Target size</label>
          <select id="sizeSelect">
            <option value="LARGE">Large</option>
            <option value="SMALL">Small</option>
          </select>
        </div>

        <div>
          <label>Depth</label>
          <select id="depthSelect">
            <option value="NEAR">Near</option>
            <option value="FAR">Far</option>
          </select>
        </div>

        <div>
          <button id="btnStart">Start Trial</button>
        </div>
        <div>
          <button id="btnReset">Reset</button>
        </div>

        <div>
          <button id="btnDownloadJSON" disabled>Download JSON Log</button>
        </div>
        <div>
          <button id="btnDownloadCSV" disabled>Download CSV Summary</button>
        </div>
      </div>

      <div id="status">Status: idle — click <b>Start Trial</b></div>
      <div id="help">
        Task: click each target circle as fast and accurately as you can. No movement needed.
        <br/>Tip: if you choose <b>Center gaze</b>, align the crosshair with the target then click.
      </div>
    </div>

    <div id="surveyModal">
      <div id="surveyCard">
        <h2>Post-trial survey (1–7)</h2>
        <div id="surveyForm"></div>
        <div id="surveyActions">
          <button id="btnSubmitSurvey">Submit survey</button>
          <button id="btnSkipSurvey">Skip</button>
        </div>
      </div>
    </div>

    <a-scene
      id="scene"
      renderer="colorManagement: true"
      background="color: #f2f4f8"
      vr-mode-ui="enabled: true"
    >
      <!-- Bright lights -->
      <a-entity light="type: ambient; intensity: 1.0"></a-entity>
      <a-entity light="type: directional; intensity: 0.8" position="1 3 2"></a-entity>

      <!-- Camera (fixed position, no WASD to avoid confusion) -->
      <a-entity id="rig" position="0 1.6 0">
        <a-camera id="cam" look-controls="pointerLockEnabled: false">
          <!-- We'll dynamically configure cursor via UI (mouse ray vs center gaze) -->
          <a-cursor id="cursor" fuse="false"></a-cursor>
        </a-camera>
      </a-entity>

      <!-- Reference frame (subtle) -->
      <a-plane rotation="-90 0 0" width="8" height="8" color="#e8ecf3"></a-plane>
      <a-entity id="targetRoot"></a-entity>

      <script type="module" src="/src/main.js"></script>
    </a-scene>
  </body>
</html>
